### Bonfire Proximity Chat App Development Brief (Revised)

**Project Overview**
Develop a cross-platform mobile app (iOS/Android via React Native with Expo) for creating and joining "bonfires"—spontaneous, location-based chat sessions discovered via Bluetooth Low Energy (BLE) beacons, emphasizing physical proximity (10-30m range) for real-world social interactions in spaces like cafes or events. Core mechanic: Creators broadcast low-power BLE beacons with a unique bonfire ID, name, optional 4-6 digit PIN, and dynamic "bonfire secret code" (rotating 8-16 char token/hash) for proximity verification. Nearby users scan beacons passively, capture the secret, and submit it (plus PIN if set) for Supabase backend validation to join, ensuring only true proximate devices access. Bonfires support 10-20 participants, default to 12-hour expiry (configurable 30min-24hrs during creation), and use standard Supabase real-time chat (no Bluetooth mesh)—with end-to-end encryption for secure, internet-based messaging.

**Key Features and Requirements**

- **Bonfire Creation and Broadcasting**: Creator app (React Native/Expo) switches to non-connectable BLE beacon mode using react-native-ble-plx library (configured in app.json for peripheral/central modes, background support) for periodic (100-1000ms tunable intervals) fire-and-forget packets; embed bonfire ID (UUID), name, hashed PIN teaser, and ephemeral secret code regenerating every 1-5min to prevent replays. Integrate motion sensors (via Expo Sensors) to pause broadcasts when inactive, targeting <10% battery drain per hour; save bonfire details to Supabase (Postgres) with configurable expiry (default 12hrs).
- **Discovery and Joining**: Passive BLE scanning triggers auto-prompts with bonfire previews (name, creator avatar) via react-native-ble-plx; auto-capture secret code for seamless submission during join flow. Public bonfires (no PIN) grant direct access post-secret validation; private ones require PIN match in Supabase query. Verification via Supabase edge function or realtime subscription check against creator's log—no approvals needed.
- **Core Enhancements**: Configurable lifespan (default 12hrs) with auto-expiry via Supabase cron jobs; capacity caps (10-20 users) triggering join queues in realtime DB; "Eco/Social" beacon presets for intervals.
- **Security and Privacy**: Direct entry for valid secret/PIN combos (public: secret only; private: secret + PIN); QR code PIN sharing (10ft camera scan via Expo Camera); per-bonfire anonymity (temp nicknames/avatars, verified profile toggle via Supabase Auth); E2EE for messages (Supabase + libraries like @noble/ed25519); hashed beacon teasers and failed secret rescan prompts. No temporary guest mode—access is all-or-nothing post-verification.
- **Additional Tech Needs**: Supabase for realtime chat (subscriptions for messages, auth/users), storage (bonfire state), and functions (secret validation); Expo for UI (flame-themed icons/emojis via react-native-vector-icons); offline persistence via Expo SQLite (local cache, sync on reconnect); push notifications (Expo Notifications + Supabase triggers) for active bonfires. Target audience: Social users seeking serendipitous, battery-efficient meetups; MVP focuses on core proximity chats, scaling to themes/AR later.

**Development Roadmap**

1. **Planning and Setup (1 week)**: Review Expo/Supabase docs for BLE/chat integration; define user journeys (creation/join flows); set up monorepo with Expo CLI, react-native-ble-plx plugin (app.json config for permissions/background), and Supabase client (supabase-js). Create wireframes in Figma; initialize Git repo.
2. **Backend Infrastructure (1-2 weeks)**: Configure Supabase project (Postgres schema for bonfires/users/messages, RLS policies for privacy); build realtime subscriptions for chat; implement auth (email/SSO), edge functions for secret/PIN validation/expiry (default 12hrs, cron for cleanup), and capacity checks. Add E2EE hooks and notifications triggers.
3. **BLE Beacon Implementation (2-3 weeks)**: Integrate react-native-ble-plx for broadcasting (non-connectable mode, interval tuning, secret embedding) and scanning (passive, auto-capture); handle iOS background limits (Uses Bluetooth LE Accessories) and Android permissions (BLUETOOTH_SCAN/CONNECT via plugin); test on physical devices with Expo Go/Dev Client, including motion pauses (Expo Accelerometer) and battery profiling. Link broadcasts to Supabase inserts.
4. **Frontend Features (2-3 weeks)**: Build UI screens (bonfire creation with expiry slider/PIN toggle, discovery list with auto-prompts, join flow with secret/PIN input, realtime chat via Supabase); use Expo Router for navigation, React Native Paper for components, and animations (e.g., flame loaders). Integrate QR scanning (Expo BarCodeScanner) and anonymity toggles.
5. **Security and Testing (1-2 weeks)**: Audit Supabase RLS and BLE for spoofing/replay (test secret rotation); validate proximity in varied environments (crowded/noisy, aim >95% join success); beta with 50 users via Expo EAS for battery, chat sync, and privacy (GDPR via Supabase). Eject minimally if needed for advanced BLE.
6. **Deployment and Iteration (1 week+)**: Build/submit to app stores via Expo EAS; monitor Supabase analytics (usage, errors); plan v2 based on feedback (e.g., voice notes). Total timeline: 8-13 weeks; leverage Expo's OTA updates for quick fixes.
